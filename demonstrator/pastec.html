<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><base href="http://pastec.io/doc/"><style>body{margin-left:0;margin-right:0;margin-top:0}#bN015htcoyT__google-cache-hdr{background:#f8f9fa;font:13px arial,sans-serif;text-align:left;color:#202124;border:0;margin:0;border-bottom:1px solid #dadce0;line-height:16px;padding:16px 28px 24px 28px}#bN015htcoyT__google-cache-hdr *{display:inline;font:inherit;text-align:inherit;color:inherit;line-height:inherit;background:none;border:0;margin:0;padding:0;letter-spacing:0}#bN015htcoyT__google-cache-hdr a{text-decoration:none;color:#1a0dab}#bN015htcoyT__google-cache-hdr a:hover{text-decoration:underline}#bN015htcoyT__google-cache-hdr a:visited{color:#4b11a8}#bN015htcoyT__google-cache-hdr div{display:block;margin-top:4px}#bN015htcoyT__google-cache-hdr b{font-weight:bold;display:inline-block;direction:ltr}</style><div id="bN015htcoyT__google-cache-hdr"><div><span>This is Google's cache of <a href="http://pastec.io/doc/">http://pastec.io/doc/</a>.</span>&nbsp;<span>It is a snapshot of the page as it appeared on 10 Jan 2021 11:49:48 GMT.</span>&nbsp;<span>The <a href="http://pastec.io/doc/">current page</a> could have changed in the meantime.</span>&nbsp;<a href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222"><span>Learn more</span>.</a></div><div><span style="display:inline-block;margin-top:8px;margin-right:104px;white-space:nowrap"><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:ZbwEjmuB4gsJ:pastec.io/doc/&amp;hl=en&amp;gl=it&amp;strip=0&amp;vwsrc=0"><span>Full version</span></a></span><span style="margin-right:28px"><span style="font-weight:bold">Text-only version</span></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:ZbwEjmuB4gsJ:pastec.io/doc/&amp;hl=en&amp;gl=it&amp;strip=0&amp;vwsrc=1"><span>View source</span></a></span></span></div><span style="display:inline-block;margin-top:8px;color:#70757a"><span>Tip: To quickly find your search term on this page, press <b>Ctrl+F</b> or <b>âŒ˜-F</b> (Mac) and use the find bar.</span></span></div><div style="position:relative; margin:8px;">
<html lang="en-US" class="no-js">
	<head>
		 	<meta charset="utf-8">
					<title>Pastec, documentation</title>
					<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
					<meta http-equiv="X-UA-Compatible" content="IE=edge">
					<meta name="keywords" content=pastec, visualink, open source, image recognition, reconnaissance d'image, technology, documentation/>
					<meta name="description" content=Documentation of Pastec/>        
							
				<!-- ==============================================
		Favicons
		=============================================== -->
		
		
		<!-- ==============================================
		CSS
		=============================================== -->    
		
		
				
		
		

		
		
		

		<!-- ==============================================
		Fonts
		=============================================== -->
		
		
		
		<!-- ==============================================
		JS
		=============================================== -->
		

	
		

		
	</head>
  
	<body data-target=#main-nav data-spy=scroll>
	
				<!-- ==============================================
		Main nav
		=============================================== -->
		<div id="main-nav" class="navbar navbar-fixed-top">
		
			<div class="container">
			
				<div class="navbar-header">
					
				<!-- ======= SMARTPHONE MENU BUTTON ======== -->
					
					
						
						
						
						
					
					
				<!-- ======= LOGO ======== -->
					<a class="navbar-brand scrollto" href="index.php">
	
						logo Visualink
						
					</a>
					
				</div>
				
				<!-- ======= LINKS ======== -->
				<div id="site-nav" class="navbar-collapse collapse">
					<ul class="nav navbar-nav navbar-right">
						<li>
							<a href="/" class="scrollto">Home</a>
						</li>
						<li>
							<a href="/#contact" class="scrollto">Contact</a>
						</li>
						<li>
							<p class="menu_divider">|</p>
						</li>
						<li>
							<a href="/doc">Doc</a>
						</li>
						<li>
							<p class="menu_divider">|</p>
						</li>
						<li>
							<a href="/blog">Blog</a>
						</li>
					</ul>
				</div>
				
			</div>
			
		</div>
		
			<!-- ==============================================
        Doc Introduction
        =============================================== -->
        
		    <div class="container text-center">
			<h2 class="blog-container-title">Introduction</h2>
		    </div>
		
		
		
		    
		   <div class="container">
		
		      <div class="row">
		
			    <div class="blog-main">
			
			        <div class="blog-post">
				    
	<h2>Presentation</h2>
	
	<p>Pastec is an open source index and search engine for image recognition based on <a href="http://www.opencv.org/" target="_blank">OpenCV</a>. It can recognize flat objects such as covers, packaged goods or artworks. It has however not been designed to recognize faces, 3D objects or barcodes and QR codes.
	<p>Pastec can be, for example, used to recognize DVD covers in a mobile app or detect near duplicate images in a big database.</p>
	
	<p>Pastec do not store the pixels of the images in its database. It stores the features of each image thanks to the technique of the <a href="http://en.wikipedia.org/wiki/Visual_Word" target="_blank">visual words</a>.
	
	<h2>Intellectual property</h2>
	
	<p>Pastec is only based on the free packages of <a href="http://www.opencv.org/" target="_blank">OpenCV</a> that are available for commercial purposes. You should therefore be free to use Pastec without paying any patent licence.
	
	<p>More precisely, Pastec uses the patent-free ORB descriptor and not the well-know SIFT and SURF descriptors that are patented.</p>
	
		    </div><!-- /.blog-post -->
	
				</div><!-- /.blog-main -->
			
			      </div><!-- /.row -->
			
			    </div><!-- /.container -->
			    
		    

	
			<!-- ==============================================
        Setup
        =============================================== -->
        
            <div class="container text-center">
	        <h2 class="blog-container-title">Setup</h2>
	    </div>
	
		
	
	    <div class="container">
	        <div class="row">
		    <div class="blog-main">
			<div class="blog-post">

<h2>Compilation</h2>

<h3>Dependancies</h3>

To be compiled, Pastec requires <a href="http://www.opencv.org/" target="_blank">OpenCV 3.X</a> and <a href="http://www.gnu.org/software/libmicrohttpd/" target="_blank">libmicrohttpd</a> and libcurl. On Ubuntu 18.04, those package can be installed using the following command:</p>

<pre data-language="shell">
sudo apt-get install libopencv-dev libmicrohttpd-dev
</pre>

<p>If you are using another distribution or operating system, you may have to compile them yourself.<p/>
			    
<h3>Building</h3>

<p>Pastec uses cmake as build system. You also need Git to get the source code.
On Ubuntu, they can be installed using the following command:

<pre data-language="shell">
sudo apt-get install cmake git
</pre>

<p>To compile Pastec, first get the sources with the following command:</p>

<pre data-language="shell">
git clone https://github.com/Visu4link/pastec.git
cd pastec
</pre>

<p>Then create a compilation folder:</p>

<pre data-language="shell">
mkdir build
</pre>

<p>Go to this subdirectory and run cmake:</p>

<pre data-language="shell">
cd build
cmake ../
</pre>

<p>Finally, run make to compile Pastec:</p>

<pre data-language="shell">
make
</pre>


<h2>Running</h2>

<p>To start Pastec, just run the pastec executable. It takes as mandatory argument the path to a file containing a list of ORB visual words. For now, please use this file <a href=/files/visualWordsORB.tar.gz>visualWordsORB.dat</a>. Next Pastec releases will contain tools that will allow you to generate your own list of visual words.</p>

<pre data-language="shell">
./pastec visualWordsORB.dat
</pre>

The default port pastec listens for the REST API is 4212. You can set an other port with the -p argument.
You can also give a path to an index file to load with the -i argument.


            </div><!-- /.blog-post -->

			</div><!-- /.blog-main -->
		
		      </div><!-- /.row -->
		
		    </div><!-- /.container -->
		    
		    

		<!-- ==============================================
        API
        =============================================== -->
        
            <div class="container text-center">
	        <h2 class="blog-container-title">API</h2>
	    </div>
	
		
	
	    <div class="container">
	        <div class="row">
		    <div class="blog-main">
			<div class="blog-post">
			        
<h2>HTTP API</h2>

<p>Pastec can be controlled using a simple HTTP API. By default, it listens to the 4212 port but you can change this using the -p argument.</p>

<p>Pastec answers are always formatted in JSON. They contains a mandatory type field that describes the result obtained or an error. Each image has an associated id that is a 32 bit unsigned integer. This id establishes the link in the index between the images and their signatures.</p>

<p>All the uploaded images must have their dimensions above 150 pixels. If one of the image dimension exceeds 1000 pixels, the image is resized so that the maximum dimension is set to 1000 pixels and the original aspect ratio is kept.</p>

<p>Here is a detailed list of the API calls:</p>

<h3>Adding an image to the index</h3>

<p>This call allows to add the signature of an image in the index to make it available for searching. You need to provide the compressed binary data of the image and an id to identify it.</p>

<ul>
    <li>Path: /index/images/&lt;image id&gt;</li>
    <li>HTTP method: PUT</li>
    <li>Data: the binary data of the image to add compressed in JPEG or a JSON containing the URL of the image in the "url" field.</li>
    <li>Answer type: "IMAGE_ADDED"</li>
    <li>Possible error types: "IMAGE_NOT_DECODED", "IMAGE_SIZE_TOO_BIG", "IMAGE_SIZE_TOO_SMALL", "IMAGE_DOWNLOADER_HTTP_ERROR" with the HTTP status code in the "image_downloader_http_response_code" field.</li>
    <li>Example:
    <ul><li>Command line with image data:
<pre data-language="shell">
curl -X PUT --data-binary @/home/test/img/1.jpg http://localhost:4212/index/images/23
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "image_id" : 23,
   "type" : "IMAGE_ADDED"
}
</pre>
</li></ul>


<ul><li>Command line with an image URL:
<pre data-language="shell">
curl -X PUT -d '{"url":"http://www.mydomain.com/path/to/my/image.jpg"}' http://localhost:4212/index/images/26
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "image_id" : 26,
   "type" : "IMAGE_ADDED"
}
</pre>
</li></ul>

</li></ul>

<h3>Removing an image from the index</h3>

<p>This call removes the signature of an image in the index thanks to its id. Be careful to not call often this method if your index is big because it is currently very slow.

<ul>
    <li>Path: /index/images/&lt;image id&gt;</li>
    <li>HTTP method: DELETE</li>
    <li>Answer type: "IMAGE_REMOVED"</li>
    <li>Possible error type: "IMAGE_NOT_FOUND"</li>
    <li>Example:
    <ul><li>Command line:
<pre data-language="shell">
curl -X DELETE http://localhost:4212/index/images/23
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "image_id" : 23,
   "type" : "IMAGE_REMOVED"
}
</pre></li>
    </ul>
    </li>
</ul>

<h3>Search request</h3>

<p>This call performs a search in the index thanks to a request image. It returns the id of the matched images from the most to the least relevant ones.</p>

<p>Request JPEG images with a size approximately equal to 450x340 pixels and a 75% quality are usally enough to achieve a good matching. Their small size allows to quickly send them over a mobile network.</p>

<ul>
    <li>Path: /index/searcher</li>
    <li>HTTP method: POST</li>
    <li>Data: the binary data of the request image compressed in JPEG or a JSON containing the URL of the image in the "url" field.</li>
    <li>Answer: "SEARCH_RESULTS" as type field and a list of the the matched image ids from the most to the least relevant one in the "image_ids" field</li>
    <li>Possible error types: "IMAGE_NOT_DECODED", "IMAGE_SIZE_TOO_BIG", "IMAGE_SIZE_TOO_SMALL"</li>
    <li>Example:
    <ul><li>Command line with image data:
<pre data-language="shell">
curl -X POST --data-binary @/home/test/img/request.jpg http://localhost:4212/index/searcher
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "image_ids" : [ 2, 5, 43 ],
   "type" : "SEARCH_RESULTS"
}
</pre>
</li></ul>

<ul><li>Command line with an image URL:
<pre data-language="shell">
curl -X POST -d '{"url":"http://www.mydomain.com/path/to/my/image.jpg"}' http://localhost:4212/index/searcher
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "image_ids" : [ 8, 12, 73 ],
   "type" : "SEARCH_RESULTS"
}
</pre>
</li></ul>


</li></ul>

<h3>Clear an index</h3>

<p>This call erases all the data currently contained in the index.</p>

<ul>
    <li>Path: /index/io</li>
    <li>HTTP method: POST</li>
    <li>Answer type: "INDEX_CLEARED"</li>
    <li>Possible error types: -</li>
    <li>Example:
    <ul><li>Command line:
<pre data-language="shell">
curl -X POST -d '{"type":"CLEAR"}' http://127.0.0.1:4212/index/io
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "type" : "INDEX_CLEARED"
}
</pre></li>
    </ul>
    </li>
</ul>

<h3>Load an index</h3>

<p>This call loads the index data in a provided path.</p> 

<ul>
    <li>Path: /index/io</li>
    <li>HTTP method: POST</li>
    <li>Data: a json with a type field of value "LOAD" and a "index_path" field that set the path where to read the index.</li>
    <li>Answer type: "INDEX_LOADED"</li>
    <li>Possible error types: "INDEX_NOT_FOUND"</li>
    <li>Example:
    <ul><li>Command line:
<pre data-language="shell">
curl -X POST -d '{"type":"LOAD", "index_path":"test.dat"}' http://127.0.0.1:4212/index/io
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "type" : "INDEX_LOADED"
}
</pre></li>
    </ul>
    </li>
</ul>

<h3>Save an index</h3>

<p>This call saves the index data in a specified path.</p>

<ul>
    <li>Path: /index/io</li>
    <li>HTTP method: POST</li>
    <li>Data: a json with a type field of value "WRITE" and a "index_path" field that set the path where to write the index</li>
    <li>Answer type: "INDEX_WRITTEN"</li>
    <li>Possible error types: "INDEX_NOT_WRITTEN"</li>
    <li>Example:
    <ul><li>Command line:
<pre data-language="shell">
curl -X POST -d '{"type":"WRITE", "index_path":"test.dat"}' http://127.0.0.1:4212/index/io
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "type" : "INDEX_WRITTEN"
}
</pre></li>
    </ul>
    </li>
</ul>

<h3>Ping Pastec</h3>

<p>This call sends a simple PING command to pastec that answers with a PONG.</p>

<ul>
    <li>Path: /</li>
    <li>HTTP method: POST</li>
    <li>Data: a json with a "type" field of value "PONG"</li>
    <li>Answer type: "PONG"</li>
    <li>Possible error types: -</li>
    <li>Example:
    <ul><li>Command line:
<pre data-language="shell">
curl -X POST -d '{"type":"PING"}' http://localhost:4212/
</pre></li>
<li>Answer:
<pre data-language="json">
{
   "type" : "PONG"
}
</pre></li>
    </ul>
    </li>
</ul>
			        
<h2>Python API</h2>

<p>In the python subdirectory of the source directory, you will also find a tiny python API that is actually just a wrapper of the HTTP API.
We encourage you to read the small source to code to understand it.</p>

				  </div>
				</div>
			      </div>
			    </div>
		    

		
		
		
	</body>
	
</html>
